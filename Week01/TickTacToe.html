<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TicTacToe</title>
</head>
<style>
    .cell {
        display: inline-block;
        background: gray;
        width: 50px;
        height: 50px;
        text-align: center;

        border: 2px solid white;
        font-size: 40px;
        vertical-align: middle;
    }
</style>
<body>
<div id="board"></div>
<script type="application/javascript">
    let pattern = [
        [0, 0, 0],
        [0, 0, 0],
        [0, 0, 0]
    ];

    const board = document.getElementById('board');
    let current = 1;
    show();

    function show() {
        board.innerHTML = '';
        for (let i = 0; i < pattern.length; i ++ ){
            for (let j = 0; j < pattern[i].length; j ++ ){
                const div = document.createElement('div');
                div.classList.add('cell');
                div.innerText = pattern[i][j] === 2 ? '⭕️' :
                    pattern[i][j] === 1 ? '❌' : '';
                div.addEventListener('click',() => move(i, j));
                board.appendChild(div);
            }
            board.appendChild(document.createElement('br'));
        }
    }

    function move(i, j) {
        pattern[i][j] = current;
        show();
        if (win(pattern, current)) {
            alert(`${current === 1 ? '❌' : '⭕️'} is winner!`)
        }

        if (!!willWin(pattern, 3 - current)) {
            console.log(`${3 - current === 1 ? '❌' : '⭕️'} will win!`)
        }
        current = 3 - current;
        console.log(bestChoice(pattern, current));
        computerMove(bestChoice(pattern, current));
    }

    function computerMove(choice) {
        if (!!choice.point) {
            const [i, j] = choice.point;
            pattern[i][j] = current;
            if (win(pattern, current)) {
                alert(`${current === 1 ? '❌' : '⭕️'} is winner!`)
            }
            show();
            current = 3 - current;
        }
        console.log(bestChoice(pattern, current))
    }

    function bestChoice(pattern, current) {
        let point = willWin(pattern, current);

        if (!!point ) {
            return {
                point: point,
                result: 1
            }
        }
        let result = -2;
        for (let i = 0; i < pattern.length; i++){
            for (let j = 0; j< pattern[i].length; j ++) {
                if (pattern[i][j] === 0) {
                    const temp = clone(pattern);
                    temp[i][j] = current;

                    let r = bestChoice(temp, 3-current).result;
                    if (-r > result) {
                        result = -r;
                        point = [i, j];
                    }

                    if (result === 1) {
                        break;
                    }
                }
            }
        }

        return {
            point,
            result: point ? result: 0,
        }
    }

    function clone(pattern) {
        return JSON.parse(JSON.stringify(pattern));
    }

    function willWin(pattern, current) {
        for (let i = 0; i< pattern.length; i ++) {
            for (let j = 0; j < pattern.length; j ++) {
                if (!pattern[i][j]) {
                    const temp = clone(pattern);
                    temp[i][j] = current;
                    if (win(temp, current)) {
                        return [i, j];
                    }
                }
            }
        }
        return null;
    }

    function win(pattern, current) {
        return rowWin(pattern, current) || columnWin(pattern, current) || diagonalWin(pattern, current);
    }

    function rowWin(pattern, current) {
        for (let i = 0; i < 3; i ++) {
            if ( pattern[i][0] === current
                && pattern[i][1] === current
                && pattern[i][2] === current)
                return true;
        }
    }

    function columnWin(pattern, current) {
        for (let i = 0; i < 3; i ++) {
            if ( pattern[0][i] === current
                && pattern[1][i] === current
                && pattern[2][i] === current)
                return true;
        }
    }

    function diagonalWin(pattern, current) {
        let result = false;
        for (let i = 0; i < 3; i ++) {
            if (pattern[i][i] === current) {
                result = true;
            }
            if (pattern[i][i] !== current) {
                result = false;
                break;
            }
        }
        if (result) return true;
        for (let i = 0; i < 3; i ++) {
            if (pattern[i][2-i] === current) {
                result = true;
            }
            if (pattern[i][2-i] !== current) {
                result = false;
                break;
            }
        }
        return result;
    }

</script>
</body>
</html>